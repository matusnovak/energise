apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-git"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageGit.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageGit)) | indent(2) }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-logs"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageLogs.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageLogs)) | indent(2) }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-config"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageConfig.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageConfig)) | indent(2) }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-builds"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageBuilds.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageBuilds)) | indent(2) }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-ssh"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageSsh.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageSsh)) | indent(2) }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: "{{ common.namespace }}-{{ gitlab.server.name }}-shared"
  labels:
    {{ service.extraLabels | to_nice_yaml | indent(4) }}
spec:
  storageClassName: "{{ common.storage.class }}"
  capacity:
    storage: "{{ gitlab.server.storageShared.capacity }}"
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  {{ lookup('template', pv_storage_spec, template_vars=dict(storage=gitlab.server.storageShared)) | indent(2) }}
