{{- include "configmap-spec" (dict 
  "Values" .Values
  "Release" .Release
  "Chart" .Chart
  "component" "server") }}
data:
  "config.yaml": |
    metrics: true
    endpoints:
      {{- if .Values.global.deploy.authelia }}
      - name: Authelia Web
        group: Authelia
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.authelia.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: Authelia Server
        group: Authelia
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/authelia-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Authelia Redis
        group: Authelia
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/authelia-redis
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Authelia SMTP
        group: Authelia
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/authelia-smtp
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.openldap }}
      - name: OpenLDAP Server
        group: OpenLDAP
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/openldap-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.phpldapadmin }}
      - name: phpLDAPAdmin Web
        group: phpLDAPAdmin
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.phpldapadmin.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: phpLDAPAdmin Server
        group: phpLDAPAdmin
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/phpldapadmin-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.postgres }}
      - name: Postgres Server
        group: Postgres
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/postgres-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Postgres Backup
        group: Postgres
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/postgres-backup
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.loki }}
      - name: Loki Server
        group: Loki
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/loki-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Loki Cassandra
        group: Loki
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/loki-cassandra
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Loki MinIO
        group: Loki
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/loki-minio
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.prometheus }}
      - name: Prometheus Web
        group: Prometheus
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.prometheus.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 401)"
      - name: Prometheus Server
        group: Prometheus
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/prometheus-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.errorpage }}
      - name: Error Page Web
        group: Error Page
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "error.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 404)"
      - name: Error Page Server
        group: Error Page
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/errorpage-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.grafana }}
      - name: Grafana Web
        group: Grafana
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.grafana.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: Grafana Server
        group: Grafana
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/grafana-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Grafana Redis
        group: Grafana
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/grafana-redis
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Grafana MinIO
        group: Grafana
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/grafana-minio
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Grafana SMTP
        group: Grafana
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/grafana-smtp
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.homer }}
      - name: Homer Web
        group: Homer
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.homer.server.subdomain }}{{ if .Values.global.homer.server.subdomain }}.{{ end }}{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 401)"
      - name: Homer Server
        group: Homer
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/homer-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.adminer }}
      - name: Adminer Web
        group: Adminer
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.adminer.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 401)"
      - name: Adminer Server
        group: Adminer
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/adminer-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.keel }}
      - name: Keel Web
        group: Keel
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.keel.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: Keel Server
        group: Keel
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/keel-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.gitlab }}
      - name: GitLab Web
        group: GitLab
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.gitlab.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: GitLab Registry
        group: GitLab
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.gitlab.server.subdomainRegistry }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200)"
      - name: GitLab Pages
        group: GitLab
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.gitlab.server.subdomainPages }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == 404"
          - "[BODY] == pat(*<h3>The page you're looking for could not be found.</h3>*)"
      - name: GitLab Server
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- if .Values.global.gitlab.runner.token }}
      - name: GitLab Runner
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-runner
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}
      - name: GitLab Cache
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-cache
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Kroki
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-kroki
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Kroki-blockdiag
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-krokiblockdiag
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Kroki-bpmn
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-krokibpmn
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Kroki-excalidraw
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-krokiexcalidraw
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Kroki-mermaid
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-krokimermaid
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Redis
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-redis
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab SMTP
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-smtp
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: GitLab Storage
        group: GitLab
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/gitlab-storage
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.drawio }}
      - name: DrawIO Web
        group: DrawIO
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.drawio.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 403, 401)"
      - name: DrawIO Server
        group: DrawIO
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/drawio-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.haste }}
      - name: Haste Web
        group: Haste
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
        headers:
          "Host": "{{ .Values.global.haste.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == any(200, 403, 401)"
      - name: Haste Server
        group: Haste
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/haste-server
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}

      {{- if .Values.global.deploy.matrix }}
      - name: Matrix API
        group: Matrix
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
          ignore-follow: true
        headers:
          "Host": "{{ .Values.global.matrix.server.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == 200"
      - name: Matrix Web
        group: Matrix
        url: https://traefik-server.{{ .Release.Namespace }}.svc.cluster.local
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          insecure: true
          timeout: 10s
          ignore-follow: true
        headers:
          "Host": "{{ .Values.global.matrix.element.subdomain }}.{{ .Values.global.domain }}"
        conditions:
          - "[STATUS] == 200"
      - name: Matrix Redis
        group: Matrix
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/matrix-redis
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Matrix Nginx
        group: Matrix
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/matrix-nginx
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      - name: Matrix Element
        group: Matrix
        url: http://{{ .Chart.Name }}-proxy.{{ .Release.Namespace }}.svc.cluster.local/deployment/matrix-element
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- range $type, $config := .Values.global.matrix.server.workers }}
      {{- if $config.enabled }}
      - name: Matrix Server {{ $type | replace "_" " " | title }}
        group: Matrix
        url: http://{{ $.Chart.Name }}-proxy.{{ $.Release.Namespace }}.svc.cluster.local/deployment/matrix-server-{{ $type | replace "_" "-" }}
        interval: 5m
        ui:
          hide-hostname: true
          hide-url: true
        client:
          timeout: 10s
        conditions:
          - "[STATUS] == 200"
      {{- end }}
      {{- end }}
      {{- end }}
